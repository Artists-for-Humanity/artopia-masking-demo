<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>AFH Invaders 2.0</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <style type="text/css">
        html {
            height: 100%;
            background-color: black;
        }

        body {
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

    </style>
</head>

<body>

    <script type="text/javascript">
        var config = {
            type: Phaser.AUTO,
            width: 960,
            height: 720,

            // Add physics: arcade
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: {
                        y: 0
                    },
                    debug: false
                }
            },
            scene: {
                preload: preload,
                create: create,
                update: update
            }
        };

        // Object.assign(sprite, Phaser.Physics.Arcade.Components.Enable, Phaser.Physics.Arcade.Components.Velocity);

        var sprite;
        var cursors;

        // Enemy Object Compnents
        var enemyImg1;
        var num_of_enemies = 6;

        // Paintball Object Components
        var paintballImg;
        var paintballX = 0;
        var paintballY = 600;
        var paintballstate = 'ready'


        var game = new Phaser.Game(config);

        function preload() {
            this.load.image('background', 'assets/background.png');
            // this.load.image('ground', 'assets/platform.png');
            this.load.image('ball', 'assets/ball.png');
            this.load.image('canvas', 'assets/canvas.png');
            this.load.image('spraycan', 'assets/spraycan.png');
        }

        function create() {

            // Add images and sprites to Scene
            this.add.image(480, 360, 'background');

            sprite = this.physics.add.sprite(480, 600, 'spraycan');

            sprite.setCollideWorldBounds(true);

            // Initialize keyboard manager
            cursors = this.input.keyboard.createCursorKeys();

            //  Some enemies for the player to shoot randomly generated between Y(50-300) and X(50-900)
            enemyImg1 = this.physics.add.sprite(randomnum(50, 900), randomnum(50, 300), 'canvas');
            enemyImg1.setVelocityX(-150);

            // Paintball
            paintballImg = this.physics.add.sprite(0, 0, 'ball');
            paintballImg.visible = false;





        }

        function update() {

            // Paintball
            paintballX = sprite.x;
            paintballY = sprite.y;

            // Assign arrow keys for movement mechanics
            if (cursors.left.isDown) {
                sprite.x -= 10;
            } else if (cursors.right.isDown) {
                sprite.x += 10;
            } else if (cursors.up.isDown) {
                sprite.y -= 10;
            } else if (cursors.down.isDown) {
                sprite.y += 10;
            } else if (cursors.space.isDown) {
                if (paintballstate == 'ready') {
                    console.log('FIREING')
                    fire_ball(paintballX, paintballY)
                }
            }
            console.log(paintballImg.y)
            console.log('PBY: ', paintballY);


            // Enemy Movement
            if (enemyImg1.x <= 20) {
                enemyImg1.setVelocityX(150);
                enemyImg1.y += 60;
            } else if (enemyImg1.x >= 915) {
                enemyImg1.setVelocityX(-150);
                enemyImg1.y += 60;
            }

            // Paintball Movement
            if (paintballImg.y <= -10) {
                paintballstate = 'ready';
                paintballImg.setVelocityY(0);
                paintballImg.y = paintballY;
                paintballImg.visible = false;
            }

            // Game Over
            // if (enemyImg1.y > 550) {
            //     enemyImg1.y = 2000
            //     game_over_text()
            //     break
            // }

        }

        function randomnum(x, y) {
            num = Phaser.Math.Between(x, y);
            return num;
        }

        // function game_over_text() {
        //     over_text = over_font.render("Game Over", True, (255, 255, 255))
        //     screen.blit(over_text, (250, 450))
        // }

        function fire_ball(x, y) {
            paintballstate = 'fire';
            paintballImg.visible = true;
            paintballImg.x = x - 8;
            paintballImg.y = y - 25;
            paintballImg.setVelocityY(-250);
        }

    </script>

</body>

</html>
